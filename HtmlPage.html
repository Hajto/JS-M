<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

    <title>Tic Tac Toe</title>
    <script>
        window.addEventListener("load", onLoad, false);
        function onLoad() {
            var winX = window.innerWidth;
            var main = document.getElementById("mainDiv");                                  //ustawianie main div'a
            /*main.style.background = "#FFFFFF";
            main.style.width = winX + "px";
            main.style.height = winX + "px";*/
            main.style.position = "absolute";
            main.style.left = "0px";
            main.style.top = "70px";

            var status = true;

            addSmall(document.getElementById("mySelect").value);                    //Tworzenie pól

            var select = document.getElementById("mySelect");                               //select
            select.addEventListener("change", onChange, false);

            document.getElementById("myColorSelect").addEventListener("change", onColorSelect, false);              //color

            var resButt = document.getElementById("buttonReset");                   //reset button
            resButt.addEventListener("click", onResetevent, false);
            resButt.style.height = "35px";
        }

        //eventy buttonow
        function onChange() {
            document.getElementById("mainDiv").innerHTML = "";
            addSmall(document.getElementById("mySelect").value);
        }

        function onColorSelect() {
            colorChange(document.getElementById("myColorSelect").value);
        }

        function onResetevent() {
            document.getElementById("mainDiv").innerHTML = "";
            addSmall(document.getElementById("mySelect").value)
        }
        // ---- //
        function colorChange(c) {
            var xNum = document.getElementById("mySelect").value;
            //>>>style dla malych divow
            for (var i = 0; i < xNum * xNum; i++) {
                //mainDiv Child
                mC = document.getElementById("mainDiv").children[i];
                mC.style.opacity = "1";
                if (c == 0) {                     //golden
                    mC.style.backgroundColor = "#000";
                } else if (c == 1) {     //dark
                    mC.style.backgroundColor = "#00F";
                    mC.style.opacity = "0.7";
                } else                          //else (red)
                    mC.style.backgroundColor = "#0F0";


            }
            //>>>style dla reszty
            var BG = document.getElementsByTagName("body")[0]; // tło

            if (c == 0) {
                BG.style.backgroundColor = "#F00";
            } else if (c == 1) {
                BG.style.backgroundColor = "#000";
            } else
                BG.style.backgroundColor = "#FFF";
        }

        // ---- //
        function addSmall(xNum) {
            var winX = window.innerWidth;
            var main = document.getElementById("mainDiv");
            Tab = [];
            for (var i = 0; i < xNum * xNum; i++) {
                Tab[i] = 'z';
            }
            winner = 'none';
            for (var i = 0; i < xNum; i++) {
                for (var j = 0; j < xNum; j++) {
                    var small = document.createElement("div");                      //ustawianie malych divow, zakomentowane sa narzucane przez ustawienia po petli
                    main.appendChild(small);
                    //small.style.background = "#ff0000";
                    small.style.width = (winX / xNum) - 6 + "px";
                    small.style.height = (winX / xNum) - 6 + "px";
                    small.style.border = "solid";
                    small.style.borderRadius = "30px";
                    small.style.borderColor = "#ffff00";
                    small.style.position = "absolute";
                    small.style.left = j * (winX / xNum) + "px";
                    small.style.top = i * (winX / xNum) + "px";
                    small.addEventListener("mousedown", onDown, false);
                    small.id = j + xNum * i;


                    var img = document.createElement("img");                        //ustawianie img (x / o)
                    small.appendChild(img);
                    img.width = winX / xNum - 6;
                    img.height = winX / xNum - 6;
                    img.id = j + xNum * i;
                }
            }
            colorChange(document.getElementById("myColorSelect").value);
            var status = false;
            var xCounter = 0;
            function onDown(e) {
                var img = e.target;
                if (img.firstChild != null) {
                    var img = img.firstChild;
                }
                if (img.src == '') {
                    if (!status) {
                        img.src = "syf2.jpg";
                        Tab[parseInt(e.target.id)] = 'x';
                        console.log(Tab);
                        xCounter++;
                    } else {
                        img.src = "syf.jpg";
                        console.log(e.target);
                        Tab[parseInt(e.target.id)] = 'y';

                    }
                    status = !status;
                    if (xCounter >= xNum) {
                        gameLogic(xNum);
                    }
                }
            }
        }


        //game logics functions (works for any xNum (yeyh~))
        function gameLogic(xNum) {
            xNum = parseInt(xNum);
            //var Tab = valuesTable(xNum); //sciaga wartosci z poszczegolnych divow do tablicy
            //alert(Tab);
            if (chkhor(xNum) == 0)             //jesli zwroci 0 to nie znalazl zwyciezcy, else znalazl
                if (chkver(xNum) == 0)
                    if (chkdiag(xNum) == 0)
                        return 0;
            if (winner == 'x')
                winner = 'Player 1!!!';
            else if (winner == 'y')
                winner = 'Player 2!!!';
            alert("Ladies and Gentleman...\nThe winner is..." + winner + "\nPress OK to restart...");
            onResetevent();
        }

        function chkhor(xNum) {
            for (var i = 0; i < xNum * xNum; i += xNum) {
                var s = 1;
                for (var j = 0; j < xNum - 1; j++) {
                    if (Tab[i + j] != Tab[i + j + 1] || Tab[i + j] == 'z')
                        break;
                    s++;
                }
                if (s == xNum) {
                    winner = Tab[i];
                    console.log = Tab[i];

                    return 1;
                }
            }
            return 0;
        }

        function chkver(xNum) {
            for (var i = 0; i < xNum; i++) {
                var s = 1;
                for (var j = 0; j < xNum * xNum - 1; j += xNum) {
                    if (Tab[i + j] != Tab[i + j + xNum] || Tab[i + j] == 'z')
                        break;
                    s++;
                }
                if (s == xNum) {
                    winner = Tab[i];
                    return 1;
                }
            }
            return 0;
        }

        function chkdiag(xNum) {
            var s = 1;
            var j = xNum + 1;
            for (var i = 0; i < xNum * xNum - 1; i += j) {
                if (Tab[i] != Tab[i + j] || Tab[i + j] == 'z')
                    break;
                s++;
            }

            if (s == xNum) {
                winner = Tab[0];
                return 1;
            }
            else
                s = 1;

            if (winner == 'none' && Tab[xNum - 1] != 'z') {
                j = xNum * (xNum - 1)
                for (var i = 0; i < xNum - 1; i++) {
                    if (Tab[j - i * (xNum - 1)] != Tab[j - (i + 1) * (xNum - 1)])
                        return 0;
                }
                winner = Tab[xNum - 1];
            } else if (Tab[xNum - 1] == 'z') return 0;
            return 1;
        }
    </script>
    <style>
        #mySelect, #myColorSelect {
            font-size: 24px;
        }

        #menu {
            background-color: #33ff12;
            height: 60px;
            width: 100%;
            position: absolute;
            left: 0;
            top: 0;
            visibility: visible;
        }

            #menu #mySelect {
                position: relative;
                left: 15px;
                top: 5px;
            }

            #menu #myColorSelect {
                position: relative;
                left: 45px;
                top: 5px;
            }

            #menu input {
                position: relative;
                left: 30px;
                top: 1px;
            }
    </style>
</head>
<body>
    <div id="mainDiv"></div>
    <div id="menu">
        <select id="mySelect">
            <option value=3 selected>3 x 3</option>
            <option value=4>4 x 4</option>
            <option value=5>5 x 5</option>
        </select>
        <input type="button" id="buttonReset" value="Reset" />
        <select id="myColorSelect">
            <option value="0" selected>Golden</option>
            <option value="1">Dark</option>
            <option value="2">Red</option>
        </select>
    </div>
    <script type="text/javascript" src="cordova.js"></script>

</body>
</html>